<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motrac Transport Planning</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #F5E6EA;
            color: #333;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: #8B1538;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: normal;
        }

        .user-info {
            font-size: 14px;
        }

        .app-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .sidebar {
            width: 80px;
            background-color: #8B1538;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        .logo {
            color: white;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 30px;
            text-align: center;
        }

        .nav-item {
            width: 50px;
            height: 50px;
            margin: 10px 0;
            background: none;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: rgba(255,255,255,0.7);
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-item:hover {
            background-color: rgba(255,255,255,0.2);
            color: white;
        }

        .nav-item.active {
            background-color: #C41E3A;
            color: white;
        }

        .tooltip {
            position: absolute;
            left: 70px;
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .nav-item:hover .tooltip {
            opacity: 1;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #E8D5DB;
        }

        .section-title {
            font-size: 18px;
            color: #8B1538;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid #F5E6EA;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }

        .form-group input, .form-group select, .form-group textarea {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #C41E3A;
            box-shadow: 0 0 0 2px rgba(196, 30, 58, 0.2);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background-color: #C41E3A;
            color: white;
        }

        .btn-primary:hover {
            background-color: #8B1538;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            text-align: left;
            padding: 12px 8px;
            border-bottom: 1px solid #E8D5DB;
        }

        th {
            background-color: #F5E6EA;
            font-weight: bold;
            color: #8B1538;
        }

        tr:hover {
            background-color: #F9F9F9;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-nieuw { background-color: #E3F2FD; color: #1976D2; }
        .status-lopend { background-color: #FFF3E0; color: #F57C00; }
        .status-afleveren { background-color: #E8F5E8; color: #388E3C; }
        .status-ophalen { background-color: #F3E5F5; color: #7B1FA2; }
        .status-voltooid { background-color: #E0E0E0; color: #424242; }

        .search-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-filter input, .search-filter select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .hidden {
            display: none;
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .edit-btn, .delete-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .edit-btn {
            background-color: #17a2b8;
            color: white;
        }

        .delete-btn {
            background-color: #dc3545;
            color: white;
        }

        .truck-planning {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .truck-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 2px solid #E8D5DB;
            position: relative;
        }

        .truck-header {
            background-color: #8B1538;
            color: white;
            padding: 10px;
            margin: -15px -15px 15px -15px;
            border-radius: 6px 6px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .truck-capacity {
            font-size: 12px;
            background-color: rgba(255,255,255,0.2);
            padding: 3px 8px;
            border-radius: 12px;
        }

        .capacity-bar {
            background-color: #f0f0f0;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .capacity-fill {
            height: 100%;
            background-color: #28a745;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .capacity-fill.warning {
            background-color: #ffc107;
        }

        .capacity-fill.danger {
            background-color: #dc3545;
        }

        .transport-item {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 8px;
            margin: 5px 0;
            font-size: 12px;
            cursor: move;
        }

        .transport-item:hover {
            background-color: #e9ecef;
        }

        .unplanned-orders {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border: 2px solid #ffc107;
        }

        .dimensions-info {
            font-size: 11px;
            color: #666;
            margin-top: 3px;
        }

        .drag-over {
            border-color: #C41E3A !important;
            background-color: #fff5f5 !important;
        }

        .drop-zone {
            min-height: 100px;
            border: 1px dashed #ccc;
            padding: 10px;
            border-radius: 4px;
        }

        #mapContainer {
            height: 500px;
            width: 100%;
            border-radius: 8px;
            border: 1px solid #E8D5DB;
        }

        .map-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .legend {
            background: white;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            margin-top: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 5px 0;
        }

        .legend-marker {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid white;
        }

        .route-controls {
            background: white;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #ccc;
            margin-bottom: 15px;
        }

        .route-info {
            background: white;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .truck-route {
            margin-bottom: 10px;
            padding: 8px;
            border-left: 4px solid;
            background-color: #f8f9fa;
        }

        .route-stop {
            font-size: 12px;
            padding: 2px 0;
            color: #666;
        }

        .route-summary {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .leaflet-routing-container {
            display: none;
        }

        .truck-list {
            background: white;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .truck-item {
            margin-bottom: 10px;
            padding: 10px;
            border-left: 4px solid;
            background-color: #f8f9fa;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .truck-item:hover {
            background-color: #e9ecef;
            transform: translateX(5px);
        }

        .truck-item.active {
            background-color: #fff3cd;
            border-color: #ffc107;
        }

        .truck-header-info {
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .truck-stats {
            font-size: 11px;
            color: #666;
            margin-bottom: 8px;
        }

        .route-orders {
            font-size: 12px;
        }

        .route-order-item {
            margin: 2px 0;
            padding: 2px 0;
            color: #555;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .search-filter {
                flex-direction: column;
            }

            .truck-planning {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>Motrac Transport Planning</h1>
        <div class="user-info">mike.gulien | Transport | dinsdag, juli 1, 2025</div>
    </header>

    <div class="app-container">
        <div class="sidebar">
            <div class="logo">MG</div>
            
<button class="nav-item active" onclick="showSection('dashboard', event)">üìä<div class="tooltip">Dashboard</div></button>
<button class="nav-item" onclick="showSection('new-order', event)">‚ûï<div class="tooltip">Nieuwe Opdracht</div></button>
<button class="nav-item" onclick="showSection('orders', event)">üìã<div class="tooltip">Transport Opdrachten</div></button>
<button class="nav-item" onclick="showSection('planning', event)">üöõ<div class="tooltip">Vrachtwagen Planning</div></button>
<button class="nav-item" onclick="showSection('map', event)">üó∫Ô∏è<div class="tooltip">Route Kaart</div></button>

        </div>

        <main class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboard" class="section">
                <div class="card">
                    <h2 class="section-title">Mijn Transport Opdrachten</h2>
                    <div class="search-filter">
                        <input type="text" id="dashboardSearch" placeholder="Zoek op klantnaam..." oninput="filterDashboard()">
                        <select id="dashboardStatusFilter" onchange="filterDashboard()">
                            <option value="">Alle statussen</option>
                            <option value="Nieuw">Nieuw</option>
                            <option value="Lopend">Lopend</option>
                            <option value="Afleveren">Afleveren</option>
                            <option value="Ophalen">Ophalen</option>
                            <option value="Voltooid">Voltooid</option>
                        </select>
                        <select id="dashboardLocationFilter" onchange="filterDashboard()">
                            <option value="">Alle locaties</option>
                            <option value="ALMERE">ALMERE</option>
                            <option value="VENLO">VENLO</option>
                            <option value="ZWIJNDRECHT">ZWIJNDRECHT</option>
                        </select>
                    </div>
                    <div class="table-container">
                        <table id="dashboardTable">
                            <thead>
                                <tr>
                                    <th>Order #</th>
                                    <th>Klant</th>
                                    <th>Transport Datum</th>
                                    <th>Status</th>
                                    <th>Locatie</th>
                                    <th>Acties</th>
                                </tr>
                            </thead>
                            <tbody id="dashboardTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Map Section -->
            <div id="map" class="section hidden">
                <div class="card">
                    <h2 class="section-title">Route Kaart Nederland</h2>
                    <div class="map-filters">
                        <input type="date" id="mapDate" onchange="updateMap()">
                        <select id="mapLocation" onchange="updateMap()">
                            <option value="">Alle locaties</option>
                            <option value="ALMERE">ALMERE</option>
                            <option value="VENLO">VENLO</option>
                            <option value="ZWIJNDRECHT">ZWIJNDRECHT</option>
                        </select>
                        <select id="mapStatus" onchange="updateMap()">
                            <option value="">Alle statussen</option>
                            <option value="Nieuw">Nieuw</option>
                            <option value="Lopend">Lopend</option>
                            <option value="Afleveren">Afleveren</option>
                            <option value="Ophalen">Ophalen</option>
                            <option value="Voltooid">Voltooid</option>
                        </select>
                        <button class="btn btn-primary" onclick="centerMap()">Reset View</button>
                    </div>
                    <div id="mapContainer"></div>
                    
                    <div class="route-controls">
                        <h4>Route Opties:</h4>
                        <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                            <label>
                                <input type="checkbox" id="showRoutes" onchange="toggleRoutes()" checked> 
                                Toon Routes
                            </label>
                            <label>
                                <input type="checkbox" id="optimizeRoutes" onchange="updateMap()"> 
                                Optimaliseer Routes
                            </label>
                            <button class="btn btn-primary" onclick="calculateAllRoutes()">Herbereken Routes</button>
                            <button class="btn btn-secondary" onclick="printRoutes()">Print Routekaarten</button>
                        </div>
                    </div>

                    <div class="route-info" id="routeInfo">
                        <h4>Route Informatie:</h4>
                        <div id="routeDetails">Selecteer filters en klik op "Herbereken Routes" om route informatie te zien.</div>
                    </div>
                    
                    <div class="truck-list" id="truckList">
                        <h4>Vrachtwagen Overzicht:</h4>
                        <div id="truckListDetails">Geen routes gepland voor geselecteerde dag.</div>
                    </div>
                </div>
            </div>

            <!-- Planning Section -->
            <div id="planning" class="section hidden">
                <div class="card">
                    <h2 class="section-title">Vrachtwagen Planning</h2>
                    <div class="search-filter">
                        <input type="date" id="planningDate" onchange="loadPlanningData()">
                        <select id="planningLocation" onchange="loadPlanningData()">
                            <option value="">Alle locaties</option>
                            <option value="ALMERE">ALMERE</option>
                            <option value="VENLO">VENLO</option>
                            <option value="ZWIJNDRECHT">ZWIJNDRECHT</option>
                        </select>
                        <button class="btn btn-primary" onclick="optimizePlanning()">Auto Optimaliseren</button>
                    </div>
                    
                    <div class="truck-planning" id="truckPlanning">
                        <!-- Truck cards will be generated here -->
                    </div>

                    <div class="unplanned-orders">
                        <h3 class="section-title">Ongeplande Transport Orders</h3>
                        <div id="unplanedOrdersList" class="drop-zone">
                            <!-- Unplanned orders will be listed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders Section -->
            <div id="orders" class="section hidden">
                <div class="card">
                    <h2 class="section-title">Alle Transport Opdrachten</h2>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Order #</th>
                                    <th>Klant</th>
                                    <th>Contactpersoon</th>
                                    <th>Adres</th>
                                    <th>Transport Datum</th>
                                    <th>Status</th>
                                    <th>Locatie</th>
                                    <th>Product & Afmetingen</th>
                                    <th>Vrachtwagen</th>
                                    <th>Acties</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- New Order Section -->
            <div id="new-order" class="section hidden">
                <div class="card">
                    <h2 class="section-title">Nieuwe Transport Opdracht</h2>
                    <form id="transportForm" onsubmit="saveOrder(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="klantNaam">Klant Naam *</label>
                                <input type="text" id="klantNaam" required>
                            </div>
                            <div class="form-group">
                                <label for="contactpersoon">Contactpersoon</label>
                                <input type="text" id="contactpersoon">
                            </div>
                            <div class="form-group">
                                <label for="transportDatum">Transport Datum *</label>
                                <input type="date" id="transportDatum" required>
                            </div>
                            <div class="form-group">
                                <label for="status">Status *</label>
                                <select id="status" required>
                                    <option value="Nieuw">Nieuw</option>
                                    <option value="Lopend">Lopend</option>
                                    <option value="Afleveren">Afleveren</option>
                                    <option value="Ophalen">Ophalen</option>
                                    <option value="Voltooid">Voltooid</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="opdracht_type">Opdracht Type *</label>
                                <select id="opdracht_type" required onchange="togglePickupFields()">
                                    <option value="Vestiging naar Klant">Vestiging naar Klant</option>
                                    <option value="Klant naar Vestiging">Klant naar Vestiging</option>
                                    <option value="Klant naar Klant">Klant naar Klant</option>
                                    <option value="Vestiging naar Vestiging">Vestiging naar Vestiging</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-grid" id="pickupSection">
                            <div class="form-group">
                                <label for="pickup_adres">Ophaal Adres *</label>
                                <textarea id="pickup_adres" rows="2" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="pickup_plaats">Ophaal Plaats *</label>
                                <input type="text" id="pickup_plaats" required>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="adres">Adres *</label>
                                <textarea id="adres" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="postcode">Postcode *</label>
                                <input type="text" id="postcode" required>
                            </div>
                            <div class="form-group">
                                <label for="plaats">Plaats *</label>
                                <input type="text" id="plaats" required>
                            </div>
                            <div class="form-group">
                                <label for="locatie">Locatie *</label>
<select id="locatie" required onchange="togglePickupFields()">
    <option value="">Selecteer locatie</option>
    <option value="ALMERE">ALMERE</option>
    <option value="VENLO">VENLO</option>
    <option value="ZWIJNDRECHT">ZWIJNDRECHT</option>
</select>

                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="product">Product</label>
                                <input type="text" id="product">
                            </div>
                            <div class="form-group">
                                <label for="gewicht">Gewicht (kg)</label>
                                <input type="number" id="gewicht" min="0" step="0.1">
                            </div>
                            <div class="form-group">
                                <label for="lengte">Lengte (cm)</label>
                                <input type="number" id="lengte" min="0" step="1">
                            </div>
                            <div class="form-group">
                                <label for="breedte">Breedte (cm)</label>
                                <input type="number" id="breedte" min="0" step="1">
                            </div>
                            <div class="form-group">
                                <label for="hoogte">Hoogte (cm)</label>
                                <input type="number" id="hoogte" min="0" step="1">
                            </div>
                            <div class="form-group">
                                <label for="vrachtwagen">Toegewezen Vrachtwagen</label>
                                <select id="vrachtwagen">
                                    <option value="">Niet gepland</option>
                                    <option value="VW-001">VW-001 (Mercedes Sprinter)</option>
                                    <option value="VW-002">VW-002 (Iveco Daily)</option>
                                    <option value="VW-003">VW-003 (Mercedes Atego)</option>
                                    <option value="VW-004">VW-004 (DAF LF)</option>
                                    <option value="VW-005">VW-005 (Scania R450)</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="opmerkingen">Opmerkingen</label>
                                <textarea id="opmerkingen" rows="3"></textarea>
                            </div>
                        </div>

                        <div class="actions">
                            <button type="submit" class="btn btn-primary">Opdracht Opslaan</button>
                            <button type="button" class="btn btn-secondary" onclick="resetForm()">Annuleren</button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        // In-memory datamodel
        let transportOrders = [
            {
                id: 1,
                klantNaam: "Philips Nederland",
                contactpersoon: "Jan de Vries",
                transportDatum: "2025-07-02",
                status: "Nieuw",
                adres: "Philipsstraat 15",
                postcode: "7903 AL",
                plaats: "HOOGEVEEN",
                locatie: "ALMERE",
                product: "Heftruck Toyota 8FBN25",
                gewicht: 2500,
                lengte: 240,
                breedte: 120,
                hoogte: 210,
                vrachtwagen: "",
                opdracht_type: "Vestiging naar Klant",
                pickup_adres: "Motrac Almere",
                pickup_plaats: "ALMERE",
                opmerkingen: "Afleveren voor 14:00"
            },
            {
                id: 2,
                klantNaam: "Used Equipment Center",
                contactpersoon: "Peter Janssen",
                transportDatum: "2025-07-03",
                status: "Lopend",
                adres: "Industrieweg 25",
                postcode: "5928 LH",
                plaats: "VENLO",
                locatie: "VENLO",
                product: "Reachtruck BT RRE160",
                gewicht: 1800,
                lengte: 200,
                breedte: 110,
                hoogte: 190,
                vrachtwagen: "VW-002",
                opdracht_type: "Klant naar Vestiging",
                pickup_adres: "Industrieweg 25",
                pickup_plaats: "VENLO",
                opmerkingen: "Ophalen uit werkplaats"
            },
            {
                id: 3,
                klantNaam: "Warehouse Solutions",
                contactpersoon: "Marie van der Berg",
                transportDatum: "2025-07-01",
                status: "Afleveren",
                adres: "Logistiekpark 8",
                postcode: "3331 LZ",
                plaats: "ZWIJNDRECHT",
                locatie: "ZWIJNDRECHT",
                product: "Elektrische heftruck Still RX60",
                gewicht: 3200,
                lengte: 280,
                breedte: 130,
                hoogte: 220,
                vrachtwagen: "VW-003",
                opdracht_type: "Vestiging naar Klant",
                pickup_adres: "Motrac Zwijndrecht",
                pickup_plaats: "ZWIJNDRECHT",
                opmerkingen: "Nieuwe installatie"
            }
        ];

        // Vrachtwagen datamodel - Beekman Transport
        let vrachtwagens = [
            {
                id: "VW-001",
                naam: "Mercedes Sprinter",
                maxGewicht: 3500,
                maxLengte: 400,
                maxBreedte: 180,
                maxHoogte: 200,
                locatie: "APELDOORN"
            },
            {
                id: "VW-002", 
                naam: "Iveco Daily",
                maxGewicht: 7000,
                maxLengte: 500,
                maxBreedte: 200,
                maxHoogte: 220,
                locatie: "APELDOORN"
            },
            {
                id: "VW-003",
                naam: "Mercedes Atego",
                maxGewicht: 12000,
                maxLengte: 750,
                maxBreedte: 250,
                maxHoogte: 280,
                locatie: "APELDOORN"
            },
            {
                id: "VW-004",
                naam: "DAF LF",
                maxGewicht: 15000,
                maxLengte: 850,
                maxBreedte: 250,
                maxHoogte: 300,
                locatie: "APELDOORN"
            },
            {
                id: "VW-005",
                naam: "Scania R450",
                maxGewicht: 25000,
                maxLengte: 1360,
                maxBreedte: 250,
                maxHoogte: 400,
                locatie: "APELDOORN"
            }
        ];
        
        // Dutch city coordinates for mapping
        const cityCoordinates = {
            "HOOGEVEEN": [52.7167, 6.4833],
            "VENLO": [51.3704, 6.1724],
            "ZWIJNDRECHT": [51.8167, 4.6333],
            "ALMERE": [52.3508, 5.2647],
            "APELDOORN": [52.2112, 5.9699],
            "AMSTERDAM": [52.3676, 4.9041],
            "ROTTERDAM": [51.9244, 4.4777],
            "DEN HAAG": [52.0705, 4.3007],
            "UTRECHT": [52.0907, 5.1214],
            "EINDHOVEN": [51.4416, 5.4697],
            "TILBURG": [51.5656, 5.0913],
            "GRONINGEN": [53.2194, 6.5665],
            "BREDA": [51.5719, 4.7683]
        };

        // Transport hub - Beekman Transport
        const TRANSPORT_HUB = {
            name: "Beekman Transport",
            address: "Oude Berghuizerweg 20, 7336 AW Apeldoorn",
            coords: [52.2112, 5.9699]
        };

        let map = null;
        let mapMarkers = [];
        let routeControls = [];
        let routeLines = [];
        let activeTruckId = null;
        
        // Truck colors for route visualization
        const truckColors = {
            'VW-001': '#FF6B6B',
            'VW-002': '#4ECDC4', 
            'VW-003': '#45B7D1',
            'VW-004': '#96CEB4',
            'VW-005': '#FFEAA7'
        };
        
        let nextId = 4;
        let editingId = null;
        let draggedOrderId = null;

        // Show/hide sections
function showSection(sectionName, event) {
    // Hide all sections
    document.querySelectorAll('.section').forEach(section => {
        section.classList.add('hidden');
    });
    // Remove active from all nav items
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });

    // Show the right section
    document.getElementById(sectionName).classList.remove('hidden');
    // Add active to the button (if event exists)
    if (event && event.currentTarget) event.currentTarget.classList.add('active');

    // Load data for section
    if (sectionName === 'dashboard' || sectionName === 'orders') loadOrders();
    else if (sectionName === 'planning') loadPlanningData();
    else if (sectionName === 'map') initializeMap();
}

        

        // Load orders into tables
        function loadOrders() {
            loadDashboardTable();
            loadOrdersTable();
        }

        function loadDashboardTable() {
            const tbody = document.getElementById('dashboardTableBody');
            tbody.innerHTML = '';
            
            transportOrders.forEach(order => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>TO-${order.id.toString().padStart(3, '0')}</td>
                    <td>${order.klantNaam}</td>
                    <td>${formatDate(order.transportDatum)}</td>
                    <td><span class="status-badge status-${order.status.toLowerCase()}">${order.status}</span></td>
                    <td>${order.locatie}</td>
                    <td>
                        <button class="edit-btn" onclick="editOrder(${order.id})">Bewerken</button>
                        <button class="delete-btn" onclick="deleteOrder(${order.id})">Verwijderen</button>
                    </td>
                `;
            });
        }

        function loadOrdersTable() {
            const tbody = document.getElementById('ordersTableBody');
            tbody.innerHTML = '';
            
            transportOrders.forEach(order => {
                const truckName = order.vrachtwagen ? vrachtwagens.find(t => t.id === order.vrachtwagen)?.naam || order.vrachtwagen : 'Niet gepland';
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>TO-${order.id.toString().padStart(3, '0')}</td>
                    <td>${order.klantNaam}</td>
                    <td>${order.contactpersoon || '-'}</td>
                    <td>${order.adres}, ${order.postcode} ${order.plaats}</td>
                    <td>${formatDate(order.transportDatum)}</td>
                    <td><span class="status-badge status-${order.status.toLowerCase()}">${order.status}</span></td>
                    <td>${order.locatie}</td>
                    <td>${order.product || '-'}<br><small>${order.gewicht || 0}kg | ${order.lengte || 0}√ó${order.breedte || 0}√ó${order.hoogte || 0}cm</small></td>
                    <td><small>${truckName}</small></td>
                    <td>
                        <button class="edit-btn" onclick="editOrder(${order.id})">Bewerken</button>
                        <button class="delete-btn" onclick="deleteOrder(${order.id})">Verwijderen</button>
                    </td>
                `;
            });
        }

        // Save order
function saveOrder(event) {
    event.preventDefault();
            
            const orderData = {
                klantNaam: document.getElementById('klantNaam').value,
                contactpersoon: document.getElementById('contactpersoon').value,
                transportDatum: document.getElementById('transportDatum').value,
                status: document.getElementById('status').value,
                opdracht_type: document.getElementById('opdracht_type').value,
                pickup_adres: document.getElementById('pickup_adres').value,
                pickup_plaats: document.getElementById('pickup_plaats').value,
                adres: document.getElementById('adres').value,
                postcode: document.getElementById('postcode').value,
                plaats: document.getElementById('plaats').value,
                locatie: document.getElementById('locatie').value,
                product: document.getElementById('product').value,
                gewicht: parseFloat(document.getElementById('gewicht').value) || 0,
                lengte: parseFloat(document.getElementById('lengte').value) || 0,
                breedte: parseFloat(document.getElementById('breedte').value) || 0,
                hoogte: parseFloat(document.getElementById('hoogte').value) || 0,
                vrachtwagen: document.getElementById('vrachtwagen').value,
                opmerkingen: document.getElementById('opmerkingen').value
            };

            if (editingId) {
                // Update existing order
                const index = transportOrders.findIndex(order => order.id === editingId);
                transportOrders[index] = { ...orderData, id: editingId };
                editingId = null;
                alert('Transport opdracht bijgewerkt!');
            } else {
                // Create new order
                transportOrders.push({ ...orderData, id: nextId++ });
                alert('Transport opdracht aangemaakt!');
            }

    resetForm();
    showSection('dashboard');
}

        // Toggle pickup fields based on order type
function togglePickupFields() {
    const orderType = document.getElementById('opdracht_type').value;
    const locatie = document.getElementById('locatie').value;
    const pickupAdres = document.getElementById('pickup_adres');
    const pickupPlaats = document.getElementById('pickup_plaats');

    // Alleen auto-fill voor vestiging naar klant/vestiging
    if ((orderType === 'Vestiging naar Klant' || orderType === 'Vestiging naar Vestiging') && locatie) {
        pickupAdres.value = 'Motrac ' + locatie;
        pickupPlaats.value = locatie;
    } else {
        pickupAdres.value = '';
        pickupPlaats.value = '';
    }
}


        // Edit order
        function editOrder(id) {
            const order = transportOrders.find(o => o.id === id);
            if (!order) return;

            editingId = id;
            
            // Fill form with order data
            document.getElementById('klantNaam').value = order.klantNaam;
            document.getElementById('contactpersoon').value = order.contactpersoon || '';
            document.getElementById('transportDatum').value = order.transportDatum;
            document.getElementById('status').value = order.status;
            document.getElementById('opdracht_type').value = order.opdracht_type || 'Vestiging naar Klant';
            document.getElementById('pickup_adres').value = order.pickup_adres || '';
            document.getElementById('pickup_plaats').value = order.pickup_plaats || '';
            document.getElementById('adres').value = order.adres;
            document.getElementById('postcode').value = order.postcode;
            document.getElementById('plaats').value = order.plaats;
            document.getElementById('locatie').value = order.locatie;
            document.getElementById('product').value = order.product || '';
            document.getElementById('gewicht').value = order.gewicht || '';
            document.getElementById('lengte').value = order.lengte || '';
            document.getElementById('breedte').value = order.breedte || '';
            document.getElementById('hoogte').value = order.hoogte || '';
            document.getElementById('vrachtwagen').value = order.vrachtwagen || '';
            document.getElementById('opmerkingen').value = order.opmerkingen || '';

            showSection('new-order');
        }

        // Delete order
        function deleteOrder(id) {
            if (confirm('Weet je zeker dat je deze transport opdracht wilt verwijderen?')) {
                transportOrders = transportOrders.filter(order => order.id !== id);
                loadOrders();
                alert('Transport opdracht verwijderd!');
            }
        }

        // Reset form
function resetForm() {
    document.getElementById('transportForm').reset();
    editingId = null;
    // Set default date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('transportDatum').value = today;
    // Zet pickup/adres ook leeg
    document.getElementById('pickup_adres').value = '';
    document.getElementById('pickup_plaats').value = '';
}


        // Planning Functions
        function loadPlanningData() {
            const selectedDate = document.getElementById('planningDate').value || getTodayString();
            const selectedLocation = document.getElementById('planningLocation').value;
            
            // Filter orders by date and location
            const planningOrders = transportOrders.filter(order => {
                const matchesDate = order.transportDatum === selectedDate;
                const matchesLocation = !selectedLocation || order.locatie === selectedLocation;
                return matchesDate && matchesLocation;
            });

            // Filter trucks by location
            const availableTrucks = vrachtwagens.filter(truck => {
                return !selectedLocation || truck.locatie === selectedLocation;
            });

            loadTruckCards(availableTrucks, planningOrders);
            loadUnplannedOrders(planningOrders);
        }

        function loadTruckCards(trucks, orders) {
            const container = document.getElementById('truckPlanning');
            container.innerHTML = '';

            trucks.forEach(truck => {
                const plannedOrders = orders.filter(order => order.vrachtwagen === truck.id);
                const totalWeight = plannedOrders.reduce((sum, order) => sum + (order.gewicht || 0), 0);

                const weightPercent = Math.min((totalWeight / truck.maxGewicht) * 100, 100);
                const weightClass = weightPercent > 90 ? 'danger' : weightPercent > 75 ? 'warning' : '';

                const truckCard = document.createElement('div');
                truckCard.className = 'truck-card';
                truckCard.innerHTML = `
                    <div class="truck-header">
                        <div>
                            <strong>${truck.id}</strong><br>
                            <small>${truck.naam}</small>
                        </div>
                        <div class="truck-capacity">
                            ${truck.locatie}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 10px;">
                        <strong>Gewicht:</strong> ${totalWeight.toFixed(0)} / ${truck.maxGewicht} kg
                        <div class="capacity-bar">
                            <div class="capacity-fill ${weightClass}" style="width: ${weightPercent}%">
                                ${weightPercent.toFixed(0)}%
                            </div>
                        </div>
                    </div>

                    <div class="drop-zone" 
                         ondrop="dropOrder(event, '${truck.id}')" 
                         ondragover="allowDrop(event)"
                         ondragleave="removeDragOver(event)">
                        ${plannedOrders.map(order => `
                            <div class="transport-item" draggable="true" ondragstart="dragOrder(event, ${order.id})">
                                <strong>TO-${order.id.toString().padStart(3, '0')}</strong> - ${order.klantNaam}<br>
                                <small>${order.product}</small>
                                <div class="dimensions-info">
                                    ${order.gewicht}kg | ${order.lengte}√ó${order.breedte}√ó${order.hoogte}cm
                                </div>
                            </div>
                        `).join('')}
                        ${plannedOrders.length === 0 ? '<div style="color: #999; text-align: center; padding: 20px;">Sleep transport orders hier</div>' : ''}
                    </div>
                `;
                container.appendChild(truckCard);
            });
        }

        function loadUnplannedOrders(orders) {
            const unplannedOrders = orders.filter(order => !order.vrachtwagen);
            const container = document.getElementById('unplanedOrdersList');
            
            if (unplannedOrders.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">Alle transport orders zijn gepland</p>';
                return;
            }

            container.innerHTML = unplannedOrders.map(order => `
                <div class="transport-item" draggable="true" ondragstart="dragOrder(event, ${order.id})">
                    <strong>TO-${order.id.toString().padStart(3, '0')}</strong> - ${order.klantNaam}<br>
                    <small>${order.product} | ${order.plaats}</small>
                    <div class="dimensions-info">
                        ${order.gewicht || 0}kg | ${order.lengte || 0}√ó${order.breedte || 0}√ó${order.hoogte || 0}cm
                    </div>
                </div>
            `).join('');
        }

        // Drag & Drop Functions
        function dragOrder(event, orderId) {
            draggedOrderId = orderId;
            event.dataTransfer.effectAllowed = "move";
        }

        function allowDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }

        function removeDragOver(event) {
            event.currentTarget.classList.remove('drag-over');
        }

        function dropOrder(event, truckId) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            
            if (!draggedOrderId) return;

            // Find the order and update its truck assignment
            const orderIndex = transportOrders.findIndex(order => order.id === draggedOrderId);
            if (orderIndex !== -1) {
                const order = transportOrders[orderIndex];
                
                if (truckId) {
                    const truck = vrachtwagens.find(t => t.id === truckId);
                    
                    // Check capacity if assigning to truck
                    if (truck && !checkTruckCapacity(truck, order)) {
                        alert(`Vrachtwagen ${truck.id} heeft onvoldoende capaciteit voor deze order!`);
                        return;
                    }
                    
                    transportOrders[orderIndex].vrachtwagen = truckId;
                    alert(`Transport order TO-${order.id.toString().padStart(3, '0')} toegewezen aan ${truck.id}`);
                } else {
                    // Unplan the order
                    transportOrders[orderIndex].vrachtwagen = '';
                    alert(`Transport order TO-${order.id.toString().padStart(3, '0')} is nu ongepland`);
                }
                
                loadPlanningData(); // Refresh the planning view
            }

            draggedOrderId = null;
        }

        function checkTruckCapacity(truck, newOrder) {
            const currentOrders = transportOrders.filter(order => 
                order.vrachtwagen === truck.id && order.id !== newOrder.id
            );
            
            const totalWeight = currentOrders.reduce((sum, order) => sum + (order.gewicht || 0), 0) + (newOrder.gewicht || 0);
            
            if (totalWeight > truck.maxGewicht) {
                return false;
            }

            // Check if single item fits in dimensions
            if ((newOrder.lengte || 0) > truck.maxLengte || 
                (newOrder.breedte || 0) > truck.maxBreedte || 
                (newOrder.hoogte || 0) > truck.maxHoogte) {
                return false;
            }

            return true;
        }

        function optimizePlanning() {
            const selectedDate = document.getElementById('planningDate').value || getTodayString();
            const selectedLocation = document.getElementById('planningLocation').value;
            
            // Get orders for optimization
            const ordersToOptimize = transportOrders.filter(order => {
                const matchesDate = order.transportDatum === selectedDate;
                const matchesLocation = !selectedLocation || order.locatie === selectedLocation;
                return matchesDate && matchesLocation;
            });

            // Get available trucks
            const availableTrucks = vrachtwagens.filter(truck => {
                return !selectedLocation || truck.locatie === selectedLocation;
            });

            // Simple optimization: assign to first fitting truck
            ordersToOptimize.forEach(order => {
                order.vrachtwagen = ''; // Reset assignment
                
                for (const truck of availableTrucks) {
                    if (checkTruckCapacity(truck, order)) {
                        order.vrachtwagen = truck.id;
                        break;
                    }
                }
            });

            loadPlanningData();
            alert('Auto optimalisatie voltooid!');
        }

        function getTodayString() {
            return new Date().toISOString().split('T')[0];
        }

        // Filter dashboard
        function filterDashboard() {
            const searchTerm = document.getElementById('dashboardSearch').value.toLowerCase();
            const statusFilter = document.getElementById('dashboardStatusFilter').value;
            const locationFilter = document.getElementById('dashboardLocationFilter').value;
            
            const filteredOrders = transportOrders.filter(order => {
                const matchesSearch = order.klantNaam.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusFilter || order.status === statusFilter;
                const matchesLocation = !locationFilter || order.locatie === locationFilter;
                
                return matchesSearch && matchesStatus && matchesLocation;
            });
            
            // Update dashboard table with filtered data
            const tbody = document.getElementById('dashboardTableBody');
            tbody.innerHTML = '';
            
            filteredOrders.forEach(order => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>TO-${order.id.toString().padStart(3, '0')}</td>
                    <td>${order.klantNaam}</td>
                    <td>${formatDate(order.transportDatum)}</td>
                    <td><span class="status-badge status-${order.status.toLowerCase()}">${order.status}</span></td>
                    <td>${order.locatie}</td>
                    <td>
                        <button class="edit-btn" onclick="editOrder(${order.id})">Bewerken</button>
                        <button class="delete-btn" onclick="deleteOrder(${order.id})">Verwijderen</button>
                    </td>
                `;
            });
        }

        // Utility functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('nl-NL');
        }

        // Map Functions
        function initializeMap() {
            if (!map) {
                map = L.map('mapContainer').setView([52.1326, 5.2913], 7); // Center of Netherlands
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(map);
            }
            updateMap();
        }

        function updateMap() {
            if (!map) return;

            // Clear existing markers and routes
            mapMarkers.forEach(marker => map.removeLayer(marker));
            routeControls.forEach(control => map.removeControl(control));
            routeLines.forEach(line => map.removeLayer(line));
            mapMarkers = [];
            routeControls = [];
            routeLines = [];

            const selectedDate = document.getElementById('mapDate').value;
            const selectedLocation = document.getElementById('mapLocation').value;
            const selectedStatus = document.getElementById('mapStatus').value;
            const showRoutes = document.getElementById('showRoutes').checked;
            const optimizeRoutes = document.getElementById('optimizeRoutes').checked;

            // Filter orders
            const filteredOrders = transportOrders.filter(order => {
                const matchesDate = !selectedDate || order.transportDatum === selectedDate;
                const matchesLocation = !selectedLocation || order.locatie === selectedLocation;
                const matchesStatus = !selectedStatus || order.status === selectedStatus;
                return matchesDate && matchesLocation && matchesStatus;
            });

            // Color mapping for statuses
            const statusColors = {
                'Nieuw': '#1976D2',
                'Lopend': '#F57C00',
                'Afleveren': '#388E3C',
                'Ophalen': '#7B1FA2',
                'Voltooid': '#424242'
            };

            // Add markers for orders
            filteredOrders.forEach((order, index) => {
                const coords = getCoordinatesForCity(order.plaats);
                if (coords) {
                    const marker = L.circleMarker(coords, {
                        color: order.vrachtwagen && truckColors[order.vrachtwagen] ? truckColors[order.vrachtwagen] : 'white',
                        fillColor: statusColors[order.status] || '#666',
                        fillOpacity: 0.8,
                        weight: 3,
                        radius: 10
                    }).addTo(map);

                    marker.bindPopup(`
                        <strong>TO-${order.id.toString().padStart(3, '0')}</strong><br>
                        <strong>Klant:</strong> ${order.klantNaam}<br>
                        <strong>Product:</strong> ${order.product || 'Niet opgegeven'}<br>
                        <strong>Adres:</strong> ${order.adres}<br>
                        <strong>Plaats:</strong> ${order.plaats}<br>
                        <strong>Status:</strong> ${order.status}<br>
                        <strong>Datum:</strong> ${formatDate(order.transportDatum)}<br>
                        <strong>Locatie:</strong> ${order.locatie}<br>
                        <strong>Gewicht:</strong> ${order.gewicht || 0} kg<br>
                        <strong>Vrachtwagen:</strong> ${order.vrachtwagen || 'Niet gepland'}
                    `);

                    // Add order number label
                    const label = L.divIcon({
                        className: 'order-label',
                        html: `<div style="background: white; border: 1px solid #333; border-radius: 3px; padding: 1px 4px; font-size: 10px; font-weight: bold;">${index + 1}</div>`,
                        iconSize: [20, 20],
                        iconAnchor: [10, 10]
                    });
                    
                    const labelMarker = L.marker(coords, { icon: label }).addTo(map);
                    mapMarkers.push(marker, labelMarker);
                }
            });

            // Add Beekman Transport hub marker
            const hubMarker = L.marker(TRANSPORT_HUB.coords, {
                icon: L.icon({
                    iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
                    shadowSize: [41, 41]
                })
            }).addTo(map);
            hubMarker.bindPopup(`<strong>${TRANSPORT_HUB.name}</strong><br>${TRANSPORT_HUB.address}<br>Transport Hub - Alle routes starten/eindigen hier`);
            mapMarkers.push(hubMarker);

            // Add Motrac location markers
            const motracLocations = {
                'ALMERE': [52.3508, 5.2647],
                'VENLO': [51.3704, 6.1724],
                'ZWIJNDRECHT': [51.8167, 4.6333]
            };

            Object.entries(motracLocations).forEach(([location, coords]) => {
                if (!selectedLocation || selectedLocation === location) {
                    const marker = L.marker(coords, {
                        icon: L.icon({
                            iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png',
                            iconSize: [25, 41],
                            iconAnchor: [12, 41],
                            popupAnchor: [1, -34],
                            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
                            shadowSize: [41, 41]
                        })
                    }).addTo(map);
                    marker.bindPopup(`<strong>Motrac ${location}</strong><br>Werkplaats locatie`);
                    mapMarkers.push(marker);
                }
            });

            // Generate routes if enabled
            if (showRoutes) {
                generateRoutes(filteredOrders, optimizeRoutes);
            }
        }

        function generateRoutes(orders, optimize = false) {
            // Group orders by truck
            const truckOrders = {};
            
            orders.forEach(order => {
                if (order.vrachtwagen) {
                    if (!truckOrders[order.vrachtwagen]) {
                        truckOrders[order.vrachtwagen] = [];
                    }
                    truckOrders[order.vrachtwagen].push(order);
                }
            });

            let routeInfoHtml = '<h4>Route Informatie:</h4>';
            let truckListHtml = '';
            
            if (Object.keys(truckOrders).length === 0) {
                routeInfoHtml += '<p>Geen routes gevonden. Zorg ervoor dat orders zijn toegewezen aan vrachtwagens.</p>';
                truckListHtml = '<p>Geen routes gepland voor geselecteerde dag.</p>';
                document.getElementById('routeDetails').innerHTML = routeInfoHtml;
                document.getElementById('truckListDetails').innerHTML = truckListHtml;
                return;
            }

            // Generate route for each truck
            Object.entries(truckOrders).forEach(([truckId, truckOrderList]) => {
                const truck = vrachtwagens.find(t => t.id === truckId);
                if (!truck) return;

                // All trucks start from Beekman Transport Apeldoorn
                const homeBase = TRANSPORT_HUB.coords;

                // Optimize route order if requested
                let orderedStops = optimize ? optimizeRouteOrder(truckOrderList, homeBase) : truckOrderList;

                // Create route waypoints based on order types
                const waypoints = [homeBase]; // Start at Beekman Transport
                const routeStops = [];

                orderedStops.forEach(order => {
                    const pickupCoords = getCoordinatesForCity(order.pickup_plaats);
                    const deliveryCoords = getCoordinatesForCity(order.plaats);
                    
                    if (order.opdracht_type === 'Vestiging naar Klant') {
                        // Start at vestiging (pickup), go to klant (delivery)
                        if (pickupCoords && deliveryCoords) {
                            waypoints.push(pickupCoords, deliveryCoords);
                            routeStops.push(
                                { type: 'Ophalen', location: order.pickup_plaats, order: order },
                                { type: 'Afleveren', location: order.plaats, order: order }
                            );
                        }
                    } else if (order.opdracht_type === 'Klant naar Vestiging') {
                        // Start at klant (pickup), go to vestiging (delivery)
                        if (pickupCoords && deliveryCoords) {
                            waypoints.push(pickupCoords, deliveryCoords);
                            routeStops.push(
                                { type: 'Ophalen', location: order.pickup_plaats, order: order },
                                { type: 'Afleveren', location: order.plaats, order: order }
                            );
                        }
                    } else if (order.opdracht_type === 'Klant naar Klant') {
                        // Klant to klant
                        if (pickupCoords && deliveryCoords) {
                            waypoints.push(pickupCoords, deliveryCoords);
                            routeStops.push(
                                { type: 'Ophalen', location: order.pickup_plaats, order: order },
                                { type: 'Afleveren', location: order.plaats, order: order }
                            );
                        }
                    } else if (order.opdracht_type === 'Vestiging naar Vestiging') {
                        // Vestiging to vestiging
                        if (pickupCoords && deliveryCoords) {
                            waypoints.push(pickupCoords, deliveryCoords);
                            routeStops.push(
                                { type: 'Ophalen', location: order.pickup_plaats, order: order },
                                { type: 'Afleveren', location: order.plaats, order: order }
                            );
                        }
                    }
                });

                waypoints.push(homeBase); // Return to Beekman Transport

                // Draw route line
                drawTruckRoute(waypoints, truckId, truckColors[truckId] || '#666');

                // Calculate totals
                const totalDistance = calculateTotalDistance(waypoints);
                const totalWeight = orderedStops.reduce((sum, order) => sum + (order.gewicht || 0), 0);
                
                // Add to route info
                routeInfoHtml += `
                    <div class="truck-route" style="border-left-color: ${truckColors[truckId] || '#666'}">
                        <div class="route-summary">${truckId} - ${truck.naam}</div>
                        <div style="font-size: 12px; color: #666; margin-bottom: 8px;">
                            Afstand: ~${totalDistance.toFixed(0)} km | Gewicht: ${totalWeight} kg | Orders: ${orderedStops.length}
                        </div>
                        <div class="route-stop"><strong>1. Start:</strong> ${TRANSPORT_HUB.name}, Apeldoorn</div>
                `;
                
                let stopNumber = 2;
                routeStops.forEach((stop) => {
                    routeInfoHtml += `
                        <div class="route-stop">
                            <strong>${stopNumber}. ${stop.type}:</strong> 
                            TO-${stop.order.id.toString().padStart(3, '0')} - ${stop.order.klantNaam} (${stop.location})
                            <br>&nbsp;&nbsp;&nbsp;${stop.order.product || 'Geen product'} (${stop.order.gewicht || 0}kg) - ${stop.order.opdracht_type}
                        </div>
                    `;
                    stopNumber++;
                });
                
                routeInfoHtml += `<div class="route-stop"><strong>${stopNumber}. Einde:</strong> Return ${TRANSPORT_HUB.name}, Apeldoorn</div></div>`;

                // Add to truck list
                truckListHtml += `
                    <div class="truck-item" style="border-left-color: ${truckColors[truckId] || '#666'}" 
                         onclick="focusOnTruck('${truckId}')" data-truck-id="${truckId}">
                        <div class="truck-header-info">
                            <span>${truckId} - ${truck.naam}</span>
                            <span style="font-size: 11px; color: ${truckColors[truckId] || '#666'};">‚óè</span>
                        </div>
                        <div class="truck-stats">
                            ${orderedStops.length} orders | ${totalWeight}kg | ~${totalDistance.toFixed(0)}km
                        </div>
                        <div class="route-orders">
                `;

                orderedStops.forEach(order => {
                    truckListHtml += `
                        <div class="route-order-item">
                            TO-${order.id.toString().padStart(3, '0')}: ${order.klantNaam} (${order.opdracht_type})
                        </div>
                    `;
                });

                truckListHtml += `</div></div>`;
            });

            document.getElementById('routeDetails').innerHTML = routeInfoHtml;
            document.getElementById('truckListDetails').innerHTML = truckListHtml;
        }

        function focusOnTruck(truckId) {
            // Remove active class from all truck items
            document.querySelectorAll('.truck-item').forEach(item => {
                item.classList.remove('active');
            });

            // Add active class to clicked truck
            document.querySelector(`[data-truck-id="${truckId}"]`).classList.add('active');

            // Highlight route on map
            activeTruckId = truckId;
            highlightTruckRoute(truckId);
        }

        function highlightTruckRoute(truckId) {
            // Reset all route line styles
            routeLines.forEach(line => {
                line.setStyle({
                    weight: 4,
                    opacity: 0.3
                });
            });

            // Highlight the selected truck's route
            const selectedRoute = routeLines.find(line => line.truckId === truckId);
            if (selectedRoute) {
                selectedRoute.setStyle({
                    weight: 6,
                    opacity: 1
                });

                // Fit map to route bounds
                const bounds = selectedRoute.getBounds();
                map.fitBounds(bounds, { padding: [20, 20] });
            }
        }

        function drawTruckRoute(waypoints, truckId, color) {
            // Draw simple polyline connecting waypoints
            const routeLine = L.polyline(waypoints, {
                color: color,
                weight: 4,
                opacity: 0.7,
                dashArray: '10, 5'
            }).addTo(map);

            // Store truck ID for later reference
            routeLine.truckId = truckId;
            routeLine.bindPopup(`<strong>Route ${truckId}</strong><br>Klik op vrachtwagen lijst voor details`);
            routeLines.push(routeLine);

            // Add direction arrows
            const arrowIcon = L.divIcon({
                className: 'route-arrow',
                html: `<div style="color: ${color}; font-size: 16px;">‚Üí</div>`,
                iconSize: [20, 20]
            });

            for (let i = 0; i < waypoints.length - 1; i++) {
                const midpoint = [
                    (waypoints[i][0] + waypoints[i + 1][0]) / 2,
                    (waypoints[i][1] + waypoints[i + 1][1]) / 2
                ];
                const arrow = L.marker(midpoint, { icon: arrowIcon }).addTo(map);
                mapMarkers.push(arrow);
            }
        }

        function optimizeRouteOrder(orders, homeBase) {
            // Simple nearest neighbor optimization
            let unvisited = [...orders];
            let route = [];
            let currentLocation = homeBase;

            while (unvisited.length > 0) {
                let nearestIndex = 0;
                let nearestDistance = Infinity;

                unvisited.forEach((order, index) => {
                    const coords = getCoordinatesForCity(order.plaats);
                    if (coords) {
                        const distance = calculateDistance(currentLocation, coords);
                        if (distance < nearestDistance) {
                            nearestDistance = distance;
                            nearestIndex = index;
                        }
                    }
                });

                const nextOrder = unvisited.splice(nearestIndex, 1)[0];
                route.push(nextOrder);
                currentLocation = getCoordinatesForCity(nextOrder.plaats);
            }

            return route;
        }

        function calculateDistance(coord1, coord2) {
            // Haversine formula for distance calculation
            const R = 6371; // Earth's radius in km
            const dLat = (coord2[0] - coord1[0]) * Math.PI / 180;
            const dLon = (coord2[1] - coord1[1]) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(coord1[0] * Math.PI / 180) * Math.cos(coord2[0] * Math.PI / 180) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function calculateTotalDistance(waypoints) {
            let total = 0;
            for (let i = 0; i < waypoints.length - 1; i++) {
                total += calculateDistance(waypoints[i], waypoints[i + 1]);
            }
            return total;
        }

        function getCoordinatesForCity(cityName) {
            const normalizedCity = cityName.toUpperCase();
            return cityCoordinates[normalizedCity] || null;
        }

        function getCoordinatesForLocation(location) {
            const motracLocations = {
                'ALMERE': [52.3508, 5.2647],
                'VENLO': [51.3704, 6.1724],
                'ZWIJNDRECHT': [51.8167, 4.6333]
            };
            return motracLocations[location] || null;
        }

        function toggleRoutes() {
            updateMap();
        }

        function calculateAllRoutes() {
            updateMap();
        }

        function printRoutes() {
            const routeDetails = document.getElementById('routeDetails').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Motrac Transport Routes</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .truck-route { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
                        .route-summary { font-weight: bold; font-size: 16px; margin-bottom: 10px; }
                        .route-stop { margin: 5px 0; }
                        h4 { color: #8B1538; }
                    </style>
                </head>
                <body>
                    <h1>Motrac Transport Route Overzicht</h1>
                    <p>Gegenereerd op: ${new Date().toLocaleDateString('nl-NL')} ${new Date().toLocaleTimeString('nl-NL')}</p>
                    ${routeDetails}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function centerMap() {
            if (map) {
                map.setView([52.1326, 5.2913], 7);
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transportDatum').value = today;
            document.getElementById('planningDate').value = today;
            document.getElementById('mapDate').value = today;
            
            // Load initial data
            loadOrders();

            // Setup drag & drop for unplanned orders area
            const unplannedArea = document.getElementById('unplanedOrdersList');
            unplannedArea.addEventListener('drop', function(event) {
                dropOrder(event, '');
            });
            unplannedArea.addEventListener('dragover', allowDrop);
            unplannedArea.addEventListener('dragleave', removeDragOver);
        });
    </script>
</body>
</html>